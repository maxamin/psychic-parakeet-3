# 1. Flash Loan (AMM Exploitation)

Category: Oracle / AMM
Tags: Execution

## What is an AMM Exploit (Flash Loan)?

An Automated Market Maker (AMM) is a decentralized exchange (DEX) model that enables users to trade cryptocurrencies without relying on order books. Instead, AMMs use smart contracts to pool liquidity and determine the price of assets based on a mathematical algorithm, which allows for instant settlement.

The standard AMM algorithm is X*Y = K.

Flash loans are uncollateralized loans that enable users to borrow funds without providing any collateral as long as the funds are repaid within the same transaction.

In this attack, the attacker exploits the liquidity pool of an AMM using a flash loan. The attacker borrows a significant amount of cryptocurrency to buy or sell a token on the AMM, temporarily causing the price to shift in their favor. They then repay the loan, pocket the profits, and withdraw their original funds from the pool.

This attack is possible because AMMs have no external price feeds and rely solely on the internal price determined by the smart contract, making them vulnerable to manipulation by large trades that can temporarily shift the price in the attacker's favor. However, some AMMs have implemented measures to prevent this attack, such as implementing price oracles to provide external price feeds and limiting the amount of liquidity that can be traded in a single transaction.

### Examples:

1. In February 2021, Platypus Finance suffered a flash loan reentrancy attack resulting in $8.5 million in lost funds.
2. In May 2021, a flash loan attack on PancakeBunny, a decentralized finance protocol, resulted in losing $200 million worth of assets.
3. Value DeFi was hit by a flash loan attack in November 2020, causing a loss of $6 million in funds. The attacker exploited a vulnerability in the system and drained the liquidity pool of Value DeFi's MultiStables vault. 
4. Cream Finance, a decentralized finance lending platform, was attacked by a flash loan in February 2021, resulting in a loss of $37.5 million. The attacker exploited a vulnerability in Cream's Iron Bank protocol and escaped with many funds. 
5. In August 2020, bZx, a decentralized finance platform, experienced a flash loan attack where the attacker manipulated the price of two tokens and caused a loss of $8 million.

Mitigation. 

Preventing flash loan exploits in automated market maker (AMM) pools can be challenging due to their decentralized and permissionless nature. AMM utilise liquidity pools and automatically adjust the price of an asset based on supply and demand. This creates opportunities for arbitrage and other trading strategies. However, this also means that anyone with an internet connection can access DeFi protocols and execute flash loans, making it difficult to prevent or restrict their use. Additionally, these loans can be challenging to detect, as they often involve complex trading patterns and multiple transactions across different protocols.

Preventing flash loan attacks is challenging as the price of assets in AMM pools is determined by supply and demand, and flash loans just enable someone to manipulate the pools which huge supply. Flash loans are used to manipulate the price of an asset in the pool, creating opportunities for traders to profit at the expense of other liquidity providers, especially in illiquid or low-volume markets.

To mitigate the risks associated with flash loans, DeFi developers and liquidity providers can implement several measures, including implementing circuit breakers or other mechanisms to temporarily halt trading in the event of sudden price changes or liquidity imbalances, transaction fees, or other restrictions on flash loan usage to deter or limit the use of flash loans in trading strategies. Improving liquidity in AMM pools to reduce the impact of flash loan arbitrage and developing more sophisticated monitoring and analysis tools to detect and prevent flash loan attacks can also be helpful.

Overall, preventing flash loans in DeFi is challenging. Still, by implementing best practices and developing more sophisticated tools and protocols, it is possible to mitigate the risks associated with flash loans and protect the interests of liquidity providers and other DeFi users.

Source: [https://cointelegraph.com/news/7-defi-protocol-hacks-in-feb-sees-21-million-in-funds-pilfered-defillama](https://cointelegraph.com/news/7-defi-protocol-hacks-in-feb-sees-21-million-in-funds-pilfered-defillama)

[https://www.coindesk.com/pancakebunny-defi-attack](https://www.coindesk.com/pancakebunny-defi-attack)

[https://cointelegraph.com/news/value-defi-hack-takes-6m-in-yet-another-flash-loan-attack](https://cointelegraph.com/news/value-defi-hack-takes-6m-in-yet-another-flash-loan-attack)

[https://cointelegraph.com/news/cream-finance-suffers-37-5m-flash-loan-attack](https://cointelegraph.com/news/cream-finance-suffers-37-5m-flash-loan-attack)

[https://www.coindesk.com/bzx-hacked-again-possible-losses-in-2-millions](https://www.coindesk.com/bzx-hacked-again-possible-losses-in-2-millions)