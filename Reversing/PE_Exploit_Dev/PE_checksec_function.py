#!/usr/bin/env python

import pefile

def checksec(pe):
 lflag=list()
 print "ASLR: %s" %pe.OPTIONAL_HEADER.IMAGE_DLL_CHARACTERISTICS_DYNAMIC_BASE
 print "DEP: %s" %pe.OPTIONAL_HEADER.IMAGE_DLL_CHARACTERISTICS_NX_COMPAT
 print "NOSEH: %s" %pe.OPTIONAL_HEADER.IMAGE_DLL_CHARACTERISTICS_NO_SEH
 
 try:
  if pe.DIRECTORY_ENTRY_LOAD_CONFIG.struct.SecurityCookie==0:
   print "Stack cookie: False"
  else:
   print "Stack cookie: True"
 except:
   print "Stack cookie: False"
  
 try:
  for i in pe.OPTIONAL_HEADER.DATA_DIRECTORY:
   lflag.append(i)
  if "IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG" in lflag:
    print "SAFESEH: True"
  else:
   print "SAFESEH: False"
 except:
   print "SAFESEH: False"

# Usage exemple:
pe=pefile.PE('drive:/path/binaryName')
checksec(pe)
