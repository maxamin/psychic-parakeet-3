package ru.nsu.xwaf.gui;

import ru.nsu.xwaf.cli.GuiDetector;
import ru.nsu.xwaf.exceptions.FieldNotFilledException;

import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

/**
 * Main frame of graphical user interface.
 * @author Alexander Ilin
 */
public class MainFrame extends JFrame {
    private JTextField urlField = new JTextField(40);
    private ParamPanel paramPanel = new ParamPanel(this);
    private ParamPanel cookiesPanel = new ParamPanel(this);
    private JComboBox<String> methodsCombo;
    {
        String[] methods = {"GET", "POST"};
        methodsCombo = new JComboBox<String>(methods);
    }

    public MainFrame() {
        this.setLayout(new GridBagLayout());
        GridBagConstraints c = new GridBagConstraints();
        c.fill = GridBagConstraints.HORIZONTAL;

        c.gridx = 0;
        c.gridy = 0;
        this.add(new JLabel("URL  "), c);

        c.gridx = 1;
        c.gridy = 0;
        c.gridwidth = 2;
        this.add(urlField, c);

        c.gridx = 0;
        c.gridy = 1;
        c.gridwidth = 1;
        this.add(new JLabel("Params  "), c);

        c.gridx = 1;
        c.gridy = 1;
        JButton addParamButton = new JButton("add");
        addParamButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                paramPanel.createParam();
                MainFrame.this.pack();
            }
        });
        this.add(addParamButton, c);

        c.gridx = 1;
        c.gridy = 2;
        c.gridwidth = 2;
        this.add(paramPanel.getPanel(), c);

        c.gridx = 0;
        c.gridy = 3;
        c.gridwidth = 1;
        this.add(new JLabel("Cookies  "), c);

        c.gridx = 1;
        c.gridy = 3;
        JButton addCookieButton = new JButton("add");
        addCookieButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                cookiesPanel.createParam();
                MainFrame.this.pack();
            }
        });
        this.add(addCookieButton, c);

        c.gridx = 1;
        c.gridy = 4;
        c.gridwidth = 2;
        this.add(cookiesPanel.getPanel(), c);

        c.gridx = 0;
        c.gridy = 5;
        c.gridwidth = 1;
        this.add(new JLabel("Method  "), c);

        c.gridx = 1;
        c.gridy = 5;
        this.add(methodsCombo, c);

        c.gridx = 0;
        c.gridy = 6;
        JButton checkButton = new JButton("check!");
        checkButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                String params;
                try {
                    params = paramPanel.getParams();
                    String url = urlField.getText();
                    if (url.isEmpty()) {
                        throw new FieldNotFilledException();
                    }
                    GuiDetector.checkURL(url + params);
                }
                catch (FieldNotFilledException ex) {
                    // show error dialog
                    JOptionPane.showMessageDialog(MainFrame.this, "Please, fill all fields.",
                            "Found unfilled field", JOptionPane.ERROR_MESSAGE);
                }
            }
        });
        this.add(checkButton, c);
    }

    private static void createAndShowGUI() {
        MainFrame frame = new MainFrame();
        frame.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);
        frame.pack();
        frame.setVisible(true);
    }

    public static void main(String[] args) {
        javax.swing.SwingUtilities.invokeLater(new Runnable() {
            @Override
            public void run() {
                createAndShowGUI();
            }
        });
    }
}
